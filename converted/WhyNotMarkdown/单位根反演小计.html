<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>单位根反演小计</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h2 id="单位根奇素数原根的基础介绍">单位根,(奇)素数原根的基础介绍</h2>
<p><span class="math inline">n</span>次单位根即<span class="math inline">x^n=1\ (x\in \mathbb C)</span>的解. 它们在复平面上面是以<span class="math inline">1+0i</span>开始,间隔<span class="math inline">\frac{2\pi}{n}</span>分布,从而<span class="math inline">n</span>等分单位圆.<br />
记<span class="math inline">\omega_n=e^{\frac{2\pi i}{n}}=\cos(\frac{2\pi i}{n})+i\sin(\frac{2\pi i}{n})</span>, 则<span class="math inline">\omega_n^0,\omega_n^1,\omega_n^2\dots \omega_n^{n-1}</span>即为所有<span class="math inline">n</span>次单位根.</p>
<p>单位根的一个神奇性质是<span class="math inline">\sum_{i=0}^{n-1}(\omega^k)^i=n[n\mid k]</span>其实就是等比数列求和.</p>
<p><span class="math display">
\begin{aligned}
&amp;n\nmid k\implies \omega^k\neq 1\implies \sum_{i=0}^{n-1}(\omega^k)^i=\frac{1-(\omega^k)^n}{1-\omega ^k}=\frac{1-(\omega^n)^k}{1-\omega ^k}=\frac{1-1^k}{1-\omega^k}=0\\
&amp;n\mid k\implies \omega^k=1\implies \sum_{i=0}^{n-1}(\omega^k)^i=n
\end{aligned}
</span></p>
<p>素数<span class="math inline">p</span>的原根<span class="math inline">g</span>是使得<span class="math inline">g^0,g^1,g^2\dots g^{\varphi(p)}=g^{p-1}</span>模<span class="math inline">p</span>意义下两两不相等(显然它们和<span class="math inline">1,2,3\dots p-1</span>之间有一一映射)的整数.于是在模<span class="math inline">p</span>意义下,<span class="math inline">g</span>是<span class="math inline">\varphi(p)=p-1</span>次单位根<span class="math inline">\omega_{p-1}</span><br />
此外,若<span class="math inline">k\mid (p-1)</span>则<span class="math inline">g^{\frac{p-1}{k}}</span>为模<span class="math inline">p</span>意义下的<span class="math inline">k</span>次单位根,<span class="math inline">\omega_k=g^{\frac{p-1}{k}}</span>.</p>
<h2 id="单位根反演">单位根反演</h2>
<p>利用单位根<span class="math inline">\sum_{i=0}^{n-1}(\omega_n^k)^i=n[n\mid k]</span>的性质用它来处理一些带着整除/同余约束的问题.<br />
例如<span class="math inline">S=\sum a_i[k\mid i]=\frac{1}{k}\sum_{i} a_i\sum_{j=0}^{k-1}{(\omega_k^i)}^j=\frac{1}{k}\sum_{j=0}^{k-1}\sum_i a_i{(\omega_k^j)}^i</span><br />
稍作拓展,设<span class="math inline">A(x)=\sum_i [k\mid i]a_i x^i</span>则<span class="math inline">S=\frac{1}{k}\sum_{j=0}^{k-1}A(\omega_k^j)</span></p>
<h3 id="loj-6247">LOJ 6247</h3>
<p><a href="https://loj.ac/problem/6247">link:九个太阳</a></p>
<blockquote>
<p>给定<span class="math inline">n,k</span>,满足<span class="math inline">k</span>是<span class="math inline">2</span>的幂,求<br />
<span class="math inline">\sum_{i=0}^{n} [k\mid i]\binom{n}{i}</span><br />
其中<span class="math inline">n&lt;10^{15},k\leq 2^{20}</span></p>
</blockquote>
<p>998244353是个oier们熟悉的,有一个原根是<span class="math inline">3</span>的质数,并且<span class="math inline">\max\{k: 2^k\mid \varphi(998244353)\}&gt; 20</span><br />
所以模998244353下,<span class="math inline">k</span>次单位根是存在的,有<span class="math inline">g^{\frac{p-1}{k}}=\omega_k</span>.</p>
<p>套用单位根反演,干掉<span class="math inline">[k\mid i]</span>有</p>
<p><span class="math display">
\begin{aligned}
\sum_{i=0}^{n} [k\mid i]\binom{n}{i}
&amp;=\sum_{i=0}^{n} \binom{n}{i}\ \frac{1}{k}\sum_{j=0}^{k-1}{(\omega_k^i)}^j\\
&amp;=\frac{1}{k}\sum_{j=0}^{k-1}\sum_{i=0}^n\binom{n}{i}{(\omega_k^j)}^i\\
&amp;=\frac{1}{k}\sum_{j=0}^{k-1}{(1+\omega_k^j)}^n
\end{aligned}
</span></p>
<p>首先一次倍增快速幂<span class="math inline">O(\log k)</span>求出<span class="math inline">\omega_k=g^{\frac{p-1}{k}}</span>, 之后<span class="math inline">O(k)</span> 递推求出<span class="math inline">\omega_k^j</span>, 然后<span class="math inline">O(k\log n)</span>暴力计算.<br />
最后根据费马小定理<span class="math inline">k^{-1}\equiv k^{p-2}\pmod p</span>求模意义下的乘法逆元即可.</p>
<h3 id="loj-2143">LOJ 2143</h3>
<p><a href="https://loj.ac/problem/2143">link:shoi2017 组合数问题.</a></p>
<blockquote>
<p>给定<span class="math inline">n,p,k,r</span>求 <span class="math inline">\sum_{i=0}^\infty \binom{nk}{ik+r}\bmod p</span><br />
其中<span class="math inline">n\leq 10^9;0\leq r&lt; k\leq 50;2\leq p&lt; 2^{30}</span><br />
不保证<span class="math inline">p</span>为素数</p>
</blockquote>
<p>这里的<span class="math inline">ik+r</span>是模<span class="math inline">k</span>意义下相等的一些数,所以也可以尝试单位根反演消除同于约束.</p>
<p><span class="math display">
\begin{aligned}
\sum_{i=0}^\infty \binom{nk}{ik+r}
&amp;=\sum_{i=0}^{nk} \binom{nk}{i}[i\equiv r\,(\!\bmod k)]
=\sum_{i=0}^{nk} \binom{nk}{i}[k\mid(i-r)]\\
&amp;=\sum_{i=0}^{nk} \binom{nk}{i}\ \frac{1}{k}\sum_{j=0}^{k-1}{(\omega_k^{i-r})}^j\\
&amp;=\frac{1}{k}\sum_{j=0}^{k-1}\sum_{i=0}^{nk} \binom{nk}{i}\omega_k^{ij-jr}\\
&amp;=\frac{1}{k}\sum_{j=0}^{k-1}\omega^{-jr}\sum_{i=0}^{nk}\binom{nk}{i}(\omega_k^j)^i\\
&amp;=\frac{1}{k}\sum_{j=0}^{k-1}\omega^{-jr}{(1+\omega_k^j)}^{nk}
\end{aligned}
</span></p>
<p>到这里并不能宣告本题解决,问题出在单位根存在性和单位根求解上面.</p>
<p>首先<span class="math inline">p</span>不是奇素数的时候,模<span class="math inline">p</span>意义下原根也许不存在,<br />
即使原根存在,求解它也很困难(对于素数来说,会有不太大的原根,枚举并检验就可以求出原根).<br />
本题的官方解法如下:</p>
<p><span class="math display">
\begin{aligned}
\sum_{i=0}^\infty \binom{nk}{ik+r}=\sum_{i=0}^{nk}\binom{nk}{i}[i\equiv r(\bmod k)]\\
=[x^r]\sum_{i=0}^{nk}\binom{nk}{i}x^{i\bmod k}
=[x^r]{(1+x)}^{nk}\bmod x^k
\end{aligned}
</span></p>
<p>即<span class="math inline">nk</span>个<span class="math inline">(1+x)</span>做长度为<span class="math inline">k+1</span>的循环卷积,结果中<span class="math inline">x^r</span>的系数.<br />
循环卷积和常规的乘法类似,有交换律,可以倍增求出来.<br />
这个做法中没有除法,也不需要解什么同余方程,模数的素性并不重要.</p>
</body>
</html>
